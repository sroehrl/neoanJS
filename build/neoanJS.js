const Neoan=function(){this.components={},this.component=(a,b={})=>(this.components[a]=[],new Component(a,b),this)},neoan=new Neoan;Object.freeze(neoan);export function Component(a,b={}){let c=null;const d={data:{},template:null,loaded:()=>{},updated:()=>{},...b},f=document.querySelectorAll(a);this.registeredIds=[];const g=Object.keys(d).filter(a=>helper.isFunction(d,a)).reduce((a,b)=>({...a,[b]:d[b]}),{}),h=Object.keys(d.data).filter(a=>!helper.isFunction(d.data,a)).reduce((a,b)=>({...a,[b]:d.data[b]}),{}),i=helper.objToFlatArray(h);f&&(f.forEach(d=>{if(1===d.nodeType){d.hasAttribute("is-template")&&(c=d.cloneNode(!0),d.style.display="none");let e=helper.registerId("c");d.id=e,this.registeredIds.push(e),neoan.components[a].push(e),b.template&&(d.innerHTML=b.template)}}),c&&f.forEach((a,b)=>{a.innerHTML===c.innerHTML?(a.parentNode.removeChild(a),delete f[b]):a.innerHTML=c.innerHTML}));const j=function(){f&&i.forEach(a=>{f.forEach(b=>{helper.filterTemplate(b)&&(renderer.process(b,helper.firstObjectKey(a),helper.deepFlatten(helper.firstObjectKey(a),h)),k(b,helper.firstObjectKey(a),helper.deepFlatten(helper.firstObjectKey(a),h)))})})},k=(a,b,c)=>{"undefined"==typeof directives.listeners[b]&&directives.binder(a,b,c,m[a.id])},l={},m={};if(f&&f.forEach(a=>{if(helper.filterTemplate(a)){l[a.id]=onChange(h,()=>{j(),setTimeout(()=>d.updated.call(m[a.id]))});let b=l[a.id];m[a.id]={...g,elements:f,data:b,rendering:j}}}),b.template){let a=helper.embrace(b.template);a.forEach(a=>{"undefined"==typeof h[a]&&(h[a]="")})}const n=()=>{j(),f&&f.forEach(a=>{helper.filterTemplate(a)&&d.loaded.call(m[a.id])})};document.removeEventListener("DOMContentLoaded",n),document.addEventListener("DOMContentLoaded",n)}const Renderer=function(){const a={};this.process=(b,c,d)=>{"undefined"==typeof a[c]&&(a[c]=[]);let e=null,f=[],g=`{{${c}}}`;a[c].forEach(a=>{let c=b.querySelector("[data-id=\""+a.dataset.id+"\"]");null!==c&&(c.innerHTML=a.innerHTML.replace(new RegExp(g,"g"),d))});let h=document.evaluate("//*[contains(text(),'"+g+"')]",b,null,XPathResult.ANY_TYPE,null);for(;e=h.iterateNext();)f.push(e);f.forEach(b=>{b.dataset.id=helper.registerId("bind"),a[c].push(b.cloneNode(!0)),b.innerHTML=b.innerHTML.replace(new RegExp(g,"g"),d)})}},renderer=new Renderer;Object.freeze(renderer);const Directives=function(){const a=["Input","Click"];this.listeners={};const b=(a,b,c)=>{c.data[a]=b.value},c=a=>{a.hasAttribute("id")||(a.id=helper.registerId("click"))};this.checkListener=function(a,b){"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]);let c=1>this.listeners[a].filter(a=>a.id===b.id).length;return c&&this.listeners[a].push({id:b.id,node:b}),c};const d=(a,b)=>a.querySelectorAll(b);this.binder=(b,c,d,e)=>{a.forEach(a=>{this["directive"+a](b,c,d,e)})},this.directiveClick=(a,b,e,f)=>{d(a,"[data-click]").forEach(a=>{c(a),this.checkListener(a.id,a)&&a.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),f[a.dataset.click].call(f)})})},this.directiveInput=(a,e,f,g)=>{d(a,"[data-n=\""+e+"\"]").forEach(a=>{("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName)&&(a.setAttribute("value",f),c(a),this.checkListener(e,a)&&a.addEventListener("input",()=>b(e,a,g)))})}},directives=new Directives;Object.freeze(directives);const Helper=function(){this.isFunction=(a,b)=>a&&"function"==typeof a[b],this.embrace=a=>{let b=a.match(/{{[a-z0-9\.]+}}/im);return b?b.map(a=>a.substring(2,a.length-2)):[]},this.computeState=(a,b)=>c=>c[a]=b({...c}),this.filterTemplate=a=>!a.hasAttribute("is-template"),this.registerId=a=>"neoan-"+a+"-"+Math.random().toString(36).substring(7),this.firstObjectKey=a=>Object.keys(a)[0],this.objToFlatArray=a=>{let b,c,d=[];return Object.keys(a).forEach(e=>{b={},"object"==typeof a[e]&&null!==a[e]?this.objToFlatArray(a[e]).forEach(f=>{c=this.firstObjectKey(f),b={},b[e+"."+c]=a[e][c],d.push(b)}):(b[e]=a[e],d.push(b))}),d},this.deepFlatten=(a,b)=>a.split(".").reduce((a,b)=>a&&a[b]?a[b]:null,b)},helper=new Helper;const isPrimitive=a=>null===a||"object"!=typeof a&&"function"!=typeof a,concatPath=(a,b)=>(b&&b.toString&&(a&&(a+="."),a+=b.toString()),a),proxyTarget=Symbol("ProxyTarget");export default((a,b)=>{let c=!1,d=!1;const e=new WeakMap,f=new WeakMap,g=(a,e,f,g)=>{c?!d&&(d=!0):b.call(k,concatPath(a,e),g,f)},h=(a,b)=>{let c=e.get(a);if(c)return c;c=new Map,e.set(a,c);let d=c.get(b);return d||(d=Reflect.getOwnPropertyDescriptor(a,b),c.set(b,d)),d},i=(a,b)=>{const c=e.get(a);c&&c.delete(b)},j={get(a,b,c){if("___target___"===b)return a;if(b===proxyTarget)return a;const d=Reflect.get(a,b,c);if(isPrimitive(d)||"constructor"===b)return d;const e=h(a,b);if(e&&!e.configurable){if(e.set&&!e.get)return;if(!1===e.writable)return d}return f.set(d,concatPath(f.get(a),b)),new Proxy(d,j)},set(a,b,c,d){c&&void 0!==c[proxyTarget]&&(c=c[proxyTarget]);const e=Reflect.get(a,b,d),h=Reflect.set(a,b,c);return e!==c&&g(f.get(a),b,e,c),h},defineProperty(a,b,c){const d=Reflect.defineProperty(a,b,c);return i(a,b),g(f.get(a),b,void 0,c.value),d},deleteProperty(a,b){const c=Reflect.get(a,b),d=Reflect.deleteProperty(a,b);return i(a,b),g(f.get(a),b,c),d},apply(a,e,f){if(!c){c=!0;const g=Reflect.apply(a,e,f);return d&&b(),c=!1,d=!1,g}return Reflect.apply(a,e,f)}};f.set(a,"");const k=new Proxy(a,j);return k});
